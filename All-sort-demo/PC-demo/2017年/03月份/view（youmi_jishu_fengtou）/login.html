<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>登录</title>
		<link rel="stylesheet" href="css/base-reset.css" />
		<link rel="stylesheet" href="css/bootstrap.min.css" />
		<link rel="stylesheet" href="css/public.css" />
		<link rel="stylesheet" href="css/yhn.css" />
		<script src="js/jquery-1.11.3.js"></script>
		<script src="js/vue.min.js"></script>
		<script src="js/Validform_v5.3.2.js"></script>
		<script src="js/code.js"></script>
	</head>
	<style>
		.form-control:focus{border:none;outline: none;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);}
		#codeBox>span{margin-left:12px;line-height:45px;}
	</style>
	<style>
		.Validform_checktip {
			margin-left: 8px !important;
			line-height: 20px !important;
			height: 20px !important;
			overflow: hidden !important;
			color: #999 !important;
			font-size: 12px !important;
		}
		
		.Validform_right {
			color: #71b83d !important;
			padding-left: 30px !important;
			background: url(img/right.png) no-repeat 10px center !important;
		}
		
		.Validform_wrong {
			color: #e4393c !important;
			padding-left: 30px !important;
			white-space: nowrap !important;
			background: url(img/wrong.png) no-repeat 10px center !important;
		}
		
		.Validform_loading {
			padding-left: 20px !important;
			background: url(images/onLoad.gif) no-repeat left center !important;
		}
		
		.Validform_error {
			background-color: #ffe7e7 !important;
		}
		.Validform_msg{display:none !important;}
		
		#Validform_msg{position:absolute;top:0;left:0;z-index: -999;}
	</style>
	<body>
		<header class="navbar navbar-default" id="top" role="banner" style="margin-top:20px">
			<div class="container">
				<img class="logo left" src="img/logo.png" />
				<div id="navbar" class="navbar-collapse collapse" style='padding-right:0'>
					<ul class="nav navbar-nav">
						<li class="">
							<a href="index.html">主页</a>
						</li>
						<li class="">
							<a href="selectFun.html">自助评估</a>
						</li>
						<li class="">
							<a href="projectApplication.html">项目申请</a>
						</li>
						<li class="">
							<a href="together.html">合作条款</a>
						</li>
						<li class="">
							<a href="aboutUs.html">关于我们</a>
						</li>
					</ul>
					<ul class="nav navbar-nav navbar-right">
						<li class="active">
							<a href="login.html">登录</a>
						</li>
						<li>
							<a href="register.html">注册</a>
						</li>
					</ul>
				</div>
			</div>
		</header>
		<section id="scope">
			<div class="login-head w1170">
				<span class="left logintitle">登录悠米技术风投</span>
				<a href="register.html"><span class="right">注册新用户</span></a>
			</div>
			<div class="login-box">
				<div class="input-group input-group-lg">
					<span class="input-group-addon" style="background:#F4F7FA;border:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);"><span class="glyphicon glyphicon-user"></span></span>
					<input v-model="postData.mobile " style="background:#F4F7FA;border:none;" type="number" class="form-control" placeholder="请输入手机号">
				</div>
				
				<div class="input-group input-group-lg" style="margin-top:30px;">
					<span style="background:#F4F7FA;border:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);" class="input-group-addon"><span class="glyphicon glyphicon-lock"></span></span>
					<input v-model="postData.password" style="background:#F4F7FA;border:none;" type="password" class="form-control" placeholder="请输入密码">
				</div>
				<div>
					<div class="left input-group input-group-lg" style="margin-top:30px;width:200px;">
						<span style="background:#F4F7FA;border:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);" class="input-group-addon"><span class="glyphicon glyphicon-eye-open"></span></span>
						<input id="code" style="background:#F4F7FA;border:none;width:100px" type="text" class="form-control" placeholder="验证码">
					</div>
					<div class="left input-group input-group-lg" style="margin-top:30px;width:200px;height:50px;">
						<p id="codeBox" style="cursor:pointer;width:100px;height:45px;border-radius:4px;background:#f6f6f6;float:left;line-height:40px;border:1px solid #ddd"><span></span><span></span><span></span><span></span></p>
					</div>
				</div>
				<p class="forget" style="overflow:hidden;width:100%;"><span id="showForget" class="right" style="margin-top:10px;">忘记登录密码?</span></p>
				<button id="confirm" type="button" class="btn btn-primary login-Btn">立即登录</button>
				<div class="shejiao" style="visibility: hidden;">
					<p class="left"></p>
					<p class="right"></p>
					<span>社交网络登录</span>
				</div>
				<div class="shejiao-img" style="visibility: hidden;">
					<img src="img/wx.png" alt="" />
					<img src="img/qq.png" alt="" / style="margin-left:154px;">
					<img src="img/wb.png" alt="" / style="margin-left:154px;">
				</div>
			</div>
			
		</section>
		<section class="forgetPWD w1170">
			<div class="login-head w1170">
				<span class="left logintitle">登录悠米技术风投</span>
				<a href="register.html"><span class="right">注册新用户</span></a>
			</div>
			<div class="login-box">
				<div class="input-group input-group-lg">
					<span class="input-group-addon" style="background:#F4F7FA;border:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);"><span class="glyphicon glyphicon-user"></span></span>
					<input id="userPhone" v-model="postData.mobile " style="background:#F4F7FA;border:none;" type="number" class="form-control" placeholder="请输入注册手机号">
					<span id="testPhone" class="Validform_checktip input-group-addon" style="padding-left:30px;border:none;background:#F4F7FA;box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);"></span>
				</div>
				
				<div class="input-group input-group-lg" style="margin-top:30px;">
					<span style="background:#F4F7FA;border:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);" class="input-group-addon"><span class="glyphicon glyphicon-lock"></span></span>
					<input id="pwd" v-model="postData.passwordA" style="background:#F4F7FA;border:none;" type="password" class="form-control kup" placeholder="输入新密码" name="pwd" datatype="*6-18">
					<span class="Validform_checktip input-group-addon" style="padding-left:30px;border:none;background:#F4F7FA;box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);"></span>
				</div>
				<div class="input-group input-group-lg" style="margin-top:30px;">
					<span style="background:#F4F7FA;border:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);" class="input-group-addon"><span class="glyphicon glyphicon-lock"></span></span>
					<input v-model="postData.password" style="background:#F4F7FA;border:none;" type="password" class="form-control kup" placeholder="确认新密码" recheck="pwd" datatype="*6-18">
					<span class="Validform_checktip input-group-addon" style="padding-left:30px;border:none;background:#F4F7FA;box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);"></span>
				</div>
				
				<div style="overflow:hidden;">
					<div class="left input-group input-group-lg" style="margin-top:30px;width:280px;">
						<span style="background:#F4F7FA;border:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);" class="input-group-addon"><span class="glyphicon glyphicon-eye-open"></span></span>
						<input v-model="postData.code"  style="background:#F4F7FA;border:none;" type="text" class="form-control" placeholder="输入收到的验证码">
					</div>
					<div class="right input-group input-group-lg" style="margin-top:30px;width:200px;">
						<button type="button" class="sendCodeBtn btn btn-default" style="width:100%;height:46px;">发送验证码</button>
					</div>
				</div>
				<button id="reset" type="button" class="btn btn-primary login-Btn">重置密码</button>
			</div>
		</section>
		<footer id="footer"></footer>
	</body>
	<script type="text/javascript" src="layer/layer.js" ></script>
	<script>
	$("#footer").load("footer.html");
		var vm = new Vue({
			el: '#scope',
			data: {
				postData:{
					mobile :'',
					password:'',
				}
			},
		});
		vm.postData.mobile=localStorage.uname;
		$("#confirm").click(function(){
			if(vm.postData.mobile!=""){
				localStorage.uname=vm.postData.mobile;
			}
			for(var i=0,x="";i<$("#codeBox>span").length;i++){
				x+=$("#codeBox>span")[i].innerHTML.toUpperCase( );
			
			};
			if($("#code").val().toUpperCase( )!=x){
				layer.msg("验证码错误，请重新输入！");
				verificationCode.init($("#codeBox>span"));
				return;
			}
			$.ajax({
				type: "get",
				url:"/services/ws/login/login",
				contentType: "application/json",
				data:vm.postData,
				success: function(jsonData) {
					var data=$.parseJSON(jsonData);
					if(data.status==="true"){
						sessionStorage.mobile=data.user.mobile;
						sessionStorage.userInfo=JSON.stringify(data.user);
						sessionStorage.haslogin="yes";
						window.location.href = "index.html";
					}else{
						layer.msg(data.msg);
					}
				}
			});
		});
		
		//忘记密码
		var vm2 = new Vue({
			el: '.forgetPWD',
			data: {
				postData:{
					mobile :'',
					password:'',
					passwordA:'',
					code:''
				}
			},
		});
		
		var interval;
		var k = 90;

		$(".forgetPWD").on('click','.sendCodeBtn', function() {
			if($("#userPhone").val() == ""){
				layer.msg("请输入手机号");
				return;
			}
			if($("#testPhone").prev().hasClass("Validform_error")){
				layer.msg("手机号码输入错误");
				return;
			}
			startTime();
			sendCode();
		})

		function startTime() {
			$(".sendCodeBtn").text("发送验证码(" + k + ")");
			$(".sendCodeBtn").attr('disabled', 'disabled')
			interval = setInterval(function() {
				k--;
				$(".sendCodeBtn").text("发送验证码(" + k + ")");
				if(k == 0) {
					clearInterval(interval);
					k = 90;
					$(".sendCodeBtn").removeAttr('disabled')
					$(".sendCodeBtn").text("发送验证码");
				}
			}, 1000);
		}
		
		function sendCode() {
			console.log(JSON.stringify({
					mobile: $("#userPhone").val(),
					type:'reset'
				}));
			$.ajax({
				type: "post",
				url: "/services/ws/auth/sendAuthCode",
				contentType: "application/json",
				data: JSON.stringify({
					mobile: $("#userPhone").val(),
					type:'reset'
				}),
				success: function(jsonData) {    
					var data = $.parseJSON(jsonData);
					if(data.status=="false"){
						layer.msg(data.msg);
						window.location.href="login.html";
					}
				}
			});
		}
		
		$(".forgetPWD").on('click','#reset', function() {
			console.log(JSON.stringify(vm2.postData));
			if(vm2.postData.mobile  == ""){
				layer.msg("手机号不能为空");
				return;
			}
			if(vm2.postData.code == ""){
				layer.msg("验证码不能为空");
				return;
			}
			if(vm2.postData.password == ""){
				layer.msg("密码不能为空");
				return;
			}
			if(vm2.postData.password != vm2.postData.passwordA){
				layer.msg("2次输入密码必须一致");
				return;
			}
			$.ajax({
				type: "post",
				url: "/services/ws/res/reset",
				contentType: "application/json",
				data: JSON.stringify(vm2.postData),
				success: function(jsonData) {
					console.log(jsonData);
					var data = $.parseJSON(jsonData);
					layer.msg(data.msg);
					$(".forgetPWD").fadeOut(150);
					$("#scope").fadeIn(150);
					
				}
			});
		});
		
		
		$("#showForget").click(function(){
			$("#scope").fadeOut(150);
			$(".forgetPWD").fadeIn(150);
			$(".icp").css("margin-top","366px");
		});
		//表单验证初始化
		$(".forgetPWD").Validform({
			tiptype:function(msg,o,cssctl){
				if(!o.obj.is("form")){
					var objtip=o.obj.siblings(".Validform_checktip");
					cssctl(objtip,o.type);
					objtip.text(msg);
				}
			},
	
		});
		
		$("#userPhone").focusout(function(){
			var mobile=vm2.postData.mobile;
			$.ajax({
				type: "get",
				url:"/services/ws/res/check",
				contentType: "application/json",
				data:{mobile:mobile},
				success: function(jsonData) {
					var data=$.parseJSON(jsonData);
						if(data.status=="false"){
							$("#testPhone").prev().removeClass("Validform_error");
							$("#testPhone").removeClass("Validform_wrong").addClass("Validform_right").text("通过信息验证！");
						}else{
								$("#testPhone").removeClass("Validform_right").addClass("Validform_wrong").text("手机号未注册！");
								$("#testPhone").prev().addClass("Validform_error");
						}
				}
			});
		});
		
		//验证码
		verificationCode.init($("#codeBox>span"));
		//刷新验证码
		$("#codeBox").click(function(){
			verificationCode.init($("#codeBox>span"));	
		});
		
		////弹出框函数
		function tanchu(cont) {
			layer.open({
				btn: ['OK'],
				content: cont, //内容
				shade: [0.5, '#000'], //遮罩层  透明度，颜色
				shadeClose: true, //点击遮罩层 关闭弹出层
				time: 0 //  自动关闭时间，  0表示不自动关闭	           
			});
		}
	</script>
</html>