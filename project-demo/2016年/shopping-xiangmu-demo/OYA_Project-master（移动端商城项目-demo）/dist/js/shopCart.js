var goodsInfo=localStorage.getItem("arr"),goodsArr=[],commitOrderArr=[];null!=goodsInfo&&(goodsArr=JSON.parse(goodsInfo));var $ul=$(".cartList ul"),xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(200==xhr.status&&4==xhr.readyState){var s=JSON.parse(xhr.responseText);goodsArr.forEach(function(a,n){for(var o=$("<li></li>"),i=$("<div class='goodsImg'></div>"),t=$("<div class='goodsText'></div>"),e=$("<div class='goodsNum' data-id='"+a.id+"'></div>"),r=0;r<s.length;r++)s[r].id==a.id&&(i.append('<span class="iconfont yuanquan"></span>'),i.append("<img src='"+s[r].url+"' />"),t.append("<h3>"+s[r].name+"</h3>"),t.append("<p data-price='"+s[r].price+"'>￥"+s[r].price+"</p>"),e.append("<span>-</span>"),e.append("<span>"+a.count+"</span>"),e.append("<span>+</span>"),e.append("<span class='iconfont icon-delete'></span>"));o.append(i),o.append(t),o.append(e),o.appendTo($ul)})}},xhr.open("GET","../json/goods.json",!0),xhr.send(null),setTimeout(function(){function s(s,a){goodsArr.forEach(function(n,o){n.id==s&&(n.count=a,0==n.count&&goodsArr.splice(o,1))}),localStorage.setItem("arr",JSON.stringify(goodsArr))}function a(){var s=0;$(".goodsImg").each(function(a,n){var o=$(this).find("span");if(o.is(".icon-jichuceshishihoudegougou")){var i=$(this).parent().find(".goodsText").find("p").attr("data-price");i=parseInt(i);var t=$(this).parent().find(".goodsNum").find("span").eq(1).html();t=parseInt(t),s+=i*t}}),0==s?o.html("请选择商品"):o.html("去结算(￥"+s+")")}var n=$(".chooseAll span"),o=$(".submitBtn"),i=$(".goodsImg"),t=$(".goodsNum"),e=0;i.find("span").click(function(){$(this).is(".yuanquan")?(e++,$(this).removeClass("yuanquan").addClass("icon-jichuceshishihoudegougou")):(e--,$(this).addClass("yuanquan").removeClass("icon-jichuceshishihoudegougou")),a(),e==i.length?n.removeClass("yuanquan").addClass("icon-jichuceshishihoudegougou"):n.addClass("yuanquan").removeClass("icon-jichuceshishihoudegougou")}),n.on("tap",function(){$(this).is(".yuanquan")?(e=i.length,$(this).removeClass("yuanquan").addClass("icon-jichuceshishihoudegougou"),i.find("span").removeClass("yuanquan").addClass("icon-jichuceshishihoudegougou"),a()):(e=0,$(this).addClass("yuanquan").removeClass("icon-jichuceshishihoudegougou"),i.find("span").addClass("yuanquan").removeClass("icon-jichuceshishihoudegougou"),a())}),t.find("span").on("tap",function(){var n=0;"-"==$(this).html()&&(n=parseInt($(this).next().html()),n>1?(n--,$(this).css("color","black")):$(this).css("color","darkgray"),$(this).next().html(n),a(),s($(this).parent().attr("data-id"),String(n))),"+"==$(this).html()&&(n=parseInt($(this).prev().html()),n<=100?(n++,$(this).css("color","black")):$(this).css("color","darkgray"),$(this).prev().html(n),a(),s($(this).parent().attr("data-id"),String(n))),$(this).hasClass("icon-delete")&&(s($(this).parent().attr("data-id"),0),$(this).parent().parent().remove(),a())}),$(".submitBtn").on("tap",function(){$(".goodsImg").each(function(s,a){var n=$(this).find("span");if(n.is(".icon-jichuceshishihoudegougou")){var o={},i=!1;o.id=$(this).parent().find(".goodsNum").attr("data-id"),o.count=$(this).parent().find(".goodsNum").children("span").eq(1).html(),commitOrderArr.forEach(function(s){o.id==s.id&&(s.count=o.count,i=!0)}),i||commitOrderArr.push(o)}}),"请选择商品"==$(this).html()?$(".commitInfo").css({opacity:"1","margin-left":"-30vw",width:"60vw"}):(commitOrderArr.forEach(function(a,n){s(a.id,0)}),localStorage.setItem("commitOrder",JSON.stringify(commitOrderArr)),location.href="my_list.html")}),$(".commitInfo span").on("tap",function(){$(this).parent().css({opacity:"0","margin-left":"0vw",width:"0vw"})})},500);