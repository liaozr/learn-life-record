<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>

<!-- ------------------------------------------------------------------------------- -->

JavaScript单线程

JavaScript语言执行环境是单线程的，单线程在程序执行时，所走的程序路径按照连续顺序排下来，

前面的必须处理好，后面的才会执行，而使用异步实现时，多个任务可以并发执行。

那么JavaScript的异步编程如何实现呢，下一节将详细阐述其异步机制。

<!-- ------------------------------------------------------------------------------- -->

并行与并发

前文提到多线程的任务可以并行执行，

而JavaScript单线程异步编程可以实现多任务并发执行，这里有必要说明一下并行与并发的区别。

<!-- ------------------------------------------------------------------------------- -->

并行，指同一时刻内多任务同时进行；

并发，指在同一时间段内，多任务同时进行着，但是某一时刻，只有某一任务执行；

通常所说的并发连接数，是指浏览器向服务器发起请求，建立TCP连接，每秒钟服务器建立的总连接数，

而假如，服务器处10ms能处理一个连接，那么其并发连接数就是100。

<!-- ------------------------------------------------------------------------------- -->

同步任务和异步任务。

任务很好理解，JavaScript代码执行就是在完成任务，所谓任务就是一个函数或一个代码块，通常以功能或目的划分，比如完成一次加法计算，完成一次ajax请求；很自然的就分为同步任务和异步任务。

同步任务是连续的，阻塞的；
同步任务是连续的，阻塞的；

而异步任务则是不连续，非阻塞的，包含异步事件及其回调，当我们谈及执行异步任务时，通常指执行其回调函数。

<!-- ------------------------------------------------------------------------------- -->

事件循环流程

关于事件循环流程分解如下：

宿主环境为JavaScript创建线程时，会创建堆(heap)和栈(stack)，堆内存储JavaScript对象，栈内存储执行上下文；

栈内执行上下文的同步任务按序执行，执行完即退栈，

而当异步任务执行时，该异步任务进入等待状态（不入栈），同时通知线程：

当触发该事件时（或该异步操作响应返回时），需向消息队列插入一个事件消息；

当事件触发或响应返回时，线程向消息队列插入该事件消息（包含事件及回调）；

当栈内同步任务执行完毕后，线程从消息队列取出一个事件消息，其对应异步任务（函数）入栈，执行回调函数，

如果未绑定回调，这个消息会被丢弃，执行完任务后退栈；

当线程空闲（即执行栈清空）时继续拉取消息队列下一轮消息（next tick，事件循环流转一次称为一次tick）。

<!-- ------------------------------------------------------------------------------- -->

在setTimeout异步回调函数里我们输出了异步任务注册到执行的时间，发现并不等于我们指定的时间，

而且两次时间间隔也都不同，考虑以下两点：

在读取消息队列的消息时，得等同步任务完成，这个是需要耗费时间的；

消息队列先进先出原则，读取此异步事件消息之前，可能还存在其他消息，执行也需要耗时；

所以异步执行时间不精确是必然的，所以我们有必要明白无论是同步任务还是异步任务，都不应该耗时太长，

当一个消息耗时太长时，应该尽可能的将其分割成多个消息。

<!-- ------------------------------------------------------------------------------- -->


</body>
</html>
