<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>

用脚本进行DOM操作的代价是很昂贵的，它是富web应用中最常见的性能瓶颈。主要有以下三种问题：

访问和修改DOM元素
修改DOM元素的样式导致repaint和reflow
通过DOM事件处理与用户进行交互

<!-- ------------------------------------------------------------------------------- -->

修改DOM元素则代价更为昂贵，因为它会导致浏览器重新计算页面的几何变化

修改dom会引起 浏览器对页面的重新布局及重绘

<!-- ------------------------------------------------------------------------------- -->

重绘与重排（Repaints 与 Reflows）

浏览器用来显示页面的所有“组件”，有：HTML标签、js、css、图片——之后会解析并生成两个内部的数据结构：

DOM树（表示页面结构）
渲染树（表示DOM节点应该如何表示）
DOM树中的每一个需要显示的节点在渲染树中至少存在一个对应的节点。
渲染树中的节点被称为“帧（frames）”或“盒（boxes）”，符合css盒模型的定义，理解页面元素为一个具有padding、margin、borders和position的盒子。

一旦渲染树构建完成，浏览器就开始显示页面元素，这个过程称为绘制（paint）。

---------------------------------------------------------------------------------

当DOM的变化影响了元素的几何属性（宽、高）——比如改变改变了边框的宽度或者给一个段落增加一些文字导致其行数的增加——浏览器就需要重新计算元素的几何属性，同样，页面中其他元素的几何属性和位置也会因此受到影响。

浏览器会使渲染树中收到影响的部分消失，重新构建渲染树，这个过程称为“重排(reflow)”。

重排完成之后，浏览器会重新将受到影响的部分绘制到浏览器中，这个过程称之为“重绘(repaint)”。

<!-- --------------------------------------------------------------------------------- -->

让动画元素脱离文档流

一般情况下，重排只影响渲染树中的一小部分，但也可能影响很大的一部分，甚至是整个渲染树。
浏览器所需的重排次数越少，应用程序的响应速度也就越快。
想象这样一种情况，页面的底部有一个动画，会推移页面整个余下的部分，这将是一次代价昂贵的大规模重排！用户也势必会感觉到页面一卡一卡的。
因此，使用以下步骤可以避免页面中的大部分重排：

使用绝对定位让页面上的动画元素脱离文档流
动画展示阶段
动画结束时，将元素恢复定位。

<!-- --------------------------------------------------------------------------------- -->

事件委托（Event Delegation）

这一个优化手段也是在前端求职面试中的高频题目。
当页面中有大量的元素，并且这些元素都需要绑定事件处理器。
每绑定一个事件处理器都是有代价的，要么加重了页面负担，要么增加了运行期的执行时间。再者，事件绑定会占用处理时间，而且浏览器需要跟踪每个事件处理器，这也会占用更多的内存。还有一种情况就是，当这些工作结束时，这些事件处理器中的绝大多数都是不再需要的（并不是100%的按钮或链接都会被用户点击），因此有很多工作是没有必要的。
事件委托的原理很简单——事件逐层冒泡并能被父级元素捕获。
使用事件委托，只需要给外层元素绑定一个处理器，就可以处理在其子元素上触发的所有事件。
有以下几点需要注意：

访问事件对象，判断事件源
按需取消文档树中的冒泡
按需阻止默认动作

<!-- --------------------------------------------------------------------------------- -->

小结

访问和操作DOM需要穿越连接ECMAScript和DOM两个岛屿之间的桥梁，为了尽可能的减少“过桥费”，有以下几点需要注意：

最小化DOM访问次数
对于需要多次访问的DOM节点，使用局部变量存储其引用
如果要操作一个HTML元素集合，建议把它拷贝到一个数组中
使用速度更快的API：比如querySelectorAll
留意重排和重绘的次数
事件委托

<!-- --------------------------------------------------------------------------------- -->

</body>
</html>
