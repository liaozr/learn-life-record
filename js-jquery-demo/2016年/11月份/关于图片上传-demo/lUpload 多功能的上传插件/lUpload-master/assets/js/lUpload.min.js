/**
 * Author : dsphper
 * Email : dsphper@gmail.com
 * Version : 1.0.1
 * Licensed under the MIT license:
 * 	http://www.opensource.org/licenses/mit-license.php
 * 	Project home:
 * 	https://github.com/dsphper/lUpload
 */
!function(a){function n(a){var d,b=a.clipboardData,c=[];for(d=0;d<b.items.length;d++)c.push(b.items[d].getAsFile());I(c),a.preventDefault(),a.stopPropagation()}function p(a){a.dataTransfer.dropEffect="copy",a.preventDefault(),a.stopPropagation()}function q(a){a.dataTransfer.dropEffect="copy",a.preventDefault(),a.stopPropagation()}function r(a){a.dataTransfer.dropEffect="copy",a.preventDefault(),a.stopPropagation()}function s(a){I(a.dataTransfer.files),a.dataTransfer.dropEffect="copy",a.preventDefault(),a.stopPropagation()}function t(a){b.dropDefa(a),a.dataTransfer.dropEffect="none",a.preventDefault(),a.stopPropagation()}function u(a){b.enterDefa(a),a.dataTransfer.dropEffect="none",a.preventDefault(),a.stopPropagation()}function v(a){b.leaveDefa(a),a.dataTransfer.dropEffect="none",a.preventDefault(),a.stopPropagation()}function w(a){b.overDefa(a),a.dataTransfer.dropEffect="none",a.preventDefault(),a.stopPropagation()}function x(c,d){var e,f,g,h,i,k;if(c.lengthComputable){if(e=(new Date).getTime(),f=c.loaded/1024,g=(e-j)/1e3,m.push((f/g).toFixed(2)),100==100*(c.loaded/c.total))for(h=0,i=0;i<m.length;i++)h+=parseInt(m[i]);k={},k.thisDom=a("#uList li").eq(d.index),k.progress=Math.round(100*(c.loaded/c.total)),k.speed=(f/g).toFixed(2),k.loaded=y({size:c.loaded}),k.total=y({size:c.total}),b.dynamic(k)}else alert("无法获得文件大小")}function y(a){var b=a.size;return b>=1073741824?b=Math.round(100*(b/1073741824))/100+" GB":b>=1048576?b=Math.round(100*(b/1048576))/100+" MB":b>=1024?b=Math.round(100*(b/1024))/100+" KB":b+=" Bytes",b}function z(a,c,d){var e={};e.file=a,e.fileReaderiImage=c,e.newImage=d,e.fileSize=y(a),e.fileType=K(a),b.setImageTpl(e),l++,l!=k.length||b.multithreading||G(k[0]),b.multithreading&&G(e.file)}function A(c){var e,f,d={};d.file=c,d.fileSize=y(c),d.fileType=K(c),b.setOtherTpl(d),e=K(c),void 0!=b.Knowntype[e]&&"undefined"!=b.Knowntype[e]&&(f=a("#uList li").eq(d.file.index),f.find(".image img").attr("src",b.Knowntype[e])),l++,l!=k.length||b.multithreading||G(k[0]),b.multithreading&&G(c)}function B(a,b){var c=new Image;c.src=b.target.result,c.addEventListener("load",function(){z(a,b,c)},!1)}function C(a){var b=new FileReader;b.addEventListener("load",function(b){F(a,b)},!1),b.readAsDataURL(a)}function D(a){var f,h,c=a.type?a.type.split("/")[1]:"other";if(c&&(f=!1,b.type.length>0)){for(o in b.type)if(c==b.type[o]){f=!0;break}if(!f)return b.error(d[3],a),e["200"]}return g>b.maxfiles?(b.error(d[1],a),e["201"]):(h=1048576*b.maxfilesize,a.size>h?(b.error(d[2],a),e["200"]):void 0)}function E(){var a,b,c;if(window.XMLHttpRequest)return new XMLHttpRequest;for(a=["msxml","msxml2","msxml3","Microsoft"],b=0;b<a.length;b++)try{return c=a[b]+".XMLHTTP",new ActiveXObject(c)}catch(d){}return null}function F(a,b){var c=a.type?a.type.split("/")[1]:"other";return"jpeg"==c||"png"==c||"gif"==c||"bmp"==c||"x-icon"==c?(B(a,b),void 0):(A(a),void 0)}function G(a){var c,d,e;a.stage="uploadIng",b.stageChange(a),c=E(),c.open("POST",b.url,!0),d=c.upload,d&&d.addEventListener("progress",function(b){x(b,a)},!1),c.addEventListener("readystatechange",function(){4==c.readyState&&200==c.status&&(b.multithreading||k.length>1&&(k.shift(),l--,H(k[0])),a.responseText=c.responseText,b.complete(a))},!1),e=new FormData,e.append("FileData",a),c.send(e),j=(new Date).getTime()}function H(a){G(a)}function I(a){var b,c;for(a=J(a),g=a.length,Array.prototype.push.apply(k,a),b=0;b<a.length;b++){if(c=D(a[b]),"deadly"==c)return!1;"warning"!=c&&(void 0==a[b].name&&(a[b].name="null"),a[b].index=h++,a[b].stage="Waiting",C(a[b]),i=a[b])}}function J(a){var c,d,e,b=[];for(c=0;c<a.length;c++)b[c]=a[c];for(c=0;c<b.length;c++)for(d=c+1;d<b.length;d++)b[d].size<b[c].size&&(e=b[d],b[d]=b[c],b[c]=e);return b}function K(a){var b=a.type?a.type.split("/")[1]:"other";return b}var b={},c={url:"",maxfiles:2,maxfilesize:2,dynamic:function(){},error:function(a){alert(a)},multithreading:!0,type:[],dragenter:function(){return!1},dragleave:function(){return!1},dragover:function(){return!1},drop:function(){return!1},dropDefa:function(){return!1},enterDefa:function(){return!1},leaveDefa:function(){return!1},overDefa:function(){return!1},tpl:function(){return"false"},setImageTpl:function(){},setOtherTpl:function(){},complete:function(){},stageChange:function(){},Knowntype:{pdf:"./image/pdf.jpg",html:"./image/html.png"},selectMultiple:!0},d=["浏览器不支持","超过最大文件数","文件大小超过限制","不允许的上传格式"],e={200:"warning",201:"deadly"},g=0,h=0,i=0,j=0,k=[],l=0,m=[];a.fn.dropFile=function(d){a.event.props.push("dataTransfer"),b=a.extend({},c,d),this.bind("dragenter",p).bind("dragleave",q).bind("dragover",r).bind("drop",s),a(document).bind("drop",t).bind("dragover",w).bind("dragleave",v).bind("dragenter",u)},a.fn.pasteFile=function(d){a.event.props.push("clipboardData"),b=a.extend({},c,d);var e=this;this.bind("mouseover",function(){e.bind("paste",n)}),this.bind("mouseout",function(){e.unbind("paste",n)})},a.fn.selectFile=function(d){b=a.extend({},c,d),void 0==a(this).attr("multiple")&&b.selectMultiple&&a(this).attr("multiple","multiple"),a(this).bind("change",function(){I(this.files)})}}(jQuery);
